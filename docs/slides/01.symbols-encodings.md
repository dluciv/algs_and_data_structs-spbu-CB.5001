<!-- -*- coding: utf-8 -*- -->
<span id="slides-title" hidden>От символов к байтам</span>

# Символ: смысл, глиф, кодирование

- - - - - - - - - - - - -
## i и «и»


- Луцiв — i (`\u0456`) кириллическая «десятиричная» i. Не то, что латинская
- В русском языке — «Абхазiя», «Авiаторъ», «Кiевъ»
- В украинском — «мiсто». «Київ» — не как в русском

<div class="fragment" />

i

- В шрифтах хранится как *одна* картинка (глиф)
  - Но символы в Кириллице и Латинице разные
- Общий символ для всех языков кириллицы
  - Но произношение и смысл разные в русском и украинском

<div class="fragment" />

И

- Есть в языках кириллицы
- Глиф и символ одни и те же
- Смысл в русском и украинском разная

- - - - - - - - - - - - -
## Ё

Ё В современном русском только 2 буквы с диакритикой — й и ё.

Ё ввели (по разным версиям):

- Княгиня Екатерина Дашкова (директор РАН) 1783 г.
- Николай Карамзин в слове «слiозы», 1797 г.

- - - - - -

## В итоге

* **Символ** — знак в письменности 
* **Глиф** — изображение символа

= = = = = =

# Алфавит и кодировка

- - - - - -

## Устная речь и переписывание

-   При устной речи символов, как таковых, нет вообще.
-   При переписывании в ручную и передаче по фототелеграфу проблем нет,
    т.к. есть начертание и семантика, но нет кодировки. Есть
    форматирование и диакритика. И даже иллюстрации иногда сами
    вставляются.

- - - - - -

## Набор символов и кодировка

**Набор символов** — множество языковых символов, используемых в какой-либо системе

Обычно символы пронумерованы и через это упорядочены

@pause@

**Кодировка** — набор правил, по которым данные преобразуются во фрагменты сигналов для их передачи/хранения

Мудрёно?

@pause@

Примеры:

* способ нумерации **символов** в компьютере и пердставления чисел при помощи **байтов** для хранения и передачи, например, UTF-8
* способ представления **байтов** при помощи символов — когда передача текста уже организована, а надо передать двоичные данные, например, Base64

Можно комбинировать, например, UTF-8 + Base64

- - - - - -

## До- и раннекомпьютерное кодирование (1)

Параллельное и смешанное

-   Семафорный телеграф — братья Шапп, 1780, 196 положений, 2 сл./мин
-   Ящик со шрифтом, типография
-   Современный телеграф

@pause@

Последовательное

-   Оптический (и солнечный) телеграф
-   Код Морзе
-   Тюремная азбука

- - - - - -

## До- и раннекомпьютерное кодирование (2)

**Бит** — минимальная единица количества информации; В зависимости от контекста, двоичная цифра либо 1-значное двоичное число

@pause@

-   Первые телеграфные системы
-   Код Бодо, 5 битов
-   МТК-1 и МТК-2

- - - - - -

## [Трансатлантический кабель](https://ru.wikipedia.org/wiki/%D0%A2%D1%80%D0%B0%D0%BD%D1%81%D0%B0%D1%82%D0%BB%D0%B0%D0%BD%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D1%82%D0%B5%D0%BB%D0%B5%D0%B3%D1%80%D0%B0%D1%84%D0%BD%D1%8B%D0%B9_%D0%BA%D0%B0%D0%B1%D0%B5%D0%BB%D1%8C)

1. 1856–1857 гг. — первая попытка, обрыв кабеля при прокладке
2. Лето 1858 г. — вторая попытка, удачная
    * август 1858 г. поздравление от королевы Виктории президенту США Джеймсу Бьюкенену, 103 слова за 16 часов
    * сентябрь 1858 г. — разрушение кабеля коррозией
3. 1865–1874 г. «Great Eastern» проложил 5 трансатлантических и один кабель в Индийском океане

<div style="text-align: center;">

![](images/01.Great_Eastern_painting_smooth_sea-2.jpg) <!--.element: style="width: 60%;" -->

</div>

- - - - - -

## Компьютерное кодирование

**Байт** — набор из нескольких (сейчас 8) битов, минимально адресуемый компьютером; обычно достаточен для кодирования 1 символа\*.

@pause@

\* Сейчас уже нет.

- - - - - -

## Кодировки

Ранние кодировки

-   Первые — телеграфные, и байт из 6 битов
-   Стандартные — до сих пор ASCII и EBCDIC

Современные кодировки

-   Производные от ASCII
-   Для представления Unicode

- - - - - -

## Примеры кодировок для Латиницы и Кириллицы

* ASCII
* CP-437
* СP-866 и CP-1251
* КОИ-8

= = = = = = =

# Unicode

- - - - - - -

## Мотивы и Предыстория

Недостатки расширений ASCII

- возможность работать с максимум двуязычными текстами, один из языков английский
- перекодировки

Первое решение (1989–1990)

- Universal Coded Character Set (UCS) — 16-битное представление символов

- - - - - - -

## Современный Unicode

Напоминаем: набор символов и кодировка — совершенно разные вещи. Кодировка задаёт способ представить символы в виде байтов (или «разобрать» эти байты «обратно» в символы).

@pause@

Пространство символов мощностью $$2^{16} + 2^{20} = 2^{16} + 2^4 \times 2^{16} = 17 \times 2^{16}$$

Символы:

-   протяжённые (обычные самостоятельные)
-   непротяжённые

    -   управляющие (право-левые, переворот, т.д.)
    -   диакритические
    -   модификаторы начертания

- - - - - - -

## Пространство

$$2^{16} + 2^{20} = 2^{16} + 2^4 \times 2^{16} = 17 \times 2^{16}$$

-   $2^{16}$ — `U+XXXX` — базовая многоязычная плоскость (Как UCS)

-   $2^4 \times 2^{16}$ — `U+1XXXX...U+10XXXX` — остальные.


- - - - - - -

## Нормализаиця

-   Канонический класс модификации — неотрицательное число,
    поставленное в соответствие символу. Для обычных символов 0, для
    диакритических знаков м.б., например, 230.
-   Канонический порядок — выстраивание с консервативной (устойчивой)
    сортировкой по возрастанию класса модификации.
-   Эквивалентность
    -   Каноническая — если эквивалентны канонические декомпозиции ế
        (`U+1EBF`) (вьет.) — м.б. и неоднозначно, т.к. у диакритик
        акута и циркумфлекса один класс.
    -   Совместимости — например, нижний индекс «${}_2$» и
        «2» — которая может быть отнесена к форматированию.

@pause@

**Нормализация** — преобразование строк у нормальной форме, в которой эквивалентные строки будут совпадать

- - - - - - -

## Композиция и декомпозиция

- **(NFD)** Каноническая декомпозиция
- **(NFC)** Каноническая декомпозиция с последующей композицией
- **KD (NFKD)** Совместимая декомпозиция
- **KC (NFKC)** Совместимая декомпозиция с последующей канонической композицией

Для справки, без подробностей

- - - - - - - -

## Упорядочивание (1)

Англ.: **collation**

В общем случае *не соответствуют кодам*. Отношение порядка — атрибут не набора
символов и даже не письменности, а языка. Сравнение многоуровневое. Пример для английского:

1.  Буквы — role < roles < rule
2.  Диакритика — role < rôle < roles
3.  Регистр — role < Role < rôle
4.  Пунктуация — role < "role" < Role
5.  Форматирование и управление — role < r**o**le < "role"

- - - - - - - -

## Упорядочивание (2)

1.  Для сравнения канонически эквивалентных строк модификаторы
    одинакового класса можно тоже отсортировать.
2.  Таблица порядка — таблица для языка, в которой перечислены веса
    символов как минимум до уровня 3. Если нет частного случая для
    конкретного символа, можно его декомпозировать.
3.  Исключения (ура, программисты счастливы):
    -   Английский и французский французский — cote < coté < côte < côté
    -   Канадский французский — cote < côte < coté < côté — у последней
        диакритики больший вес

- - - - - - - -

## Кодировки

- UTF-32 (UCS-4) — постоянная длина, но по 4 байта на символ много
- UTF-16 (UCS-2)
  - постоянная длина для нулевой плоскости
  - «Родная» для Java, .NET, Qt, Windows и многих дрругих современных платформ.
  - Для перехода на другие плоскости — управляющие символы. Символы с
    кодами меньше `0x10000` ($2^{16}$) кодируются как есть, символы с кодами
    `0x10000–0x10FFFE` кодируются двумя словами из диапазонов `0xD800–0xDBFF` и
    `0xDC00–0xDFFF` (т.н. суррогатная пара), образуя $2^{10} \times 2^{10} = 2^{20}$ таких комбинаций
  - бывает LE и BE
- UTF-8 - переменной длины

[UTF-8 Everywhere Manifesto](https://utf8everywhere.org)

- - - - - - - - -

## UTF-8

| **Unicode** | Байт 1 | Байт 2 | Байт 3 | Байт 4 |
|-------------|--------|--------|--------|--------|
| `U+000000-U+00007F` `0xxxxxxx` | `0xxxxxxx` | | | |
| `U+000080-U+0007FF` `00000yyy xxxxxxxx` | `110yyyxx` | `10xxxxxx` | | |
| `U+000800-U+00FFFF` `yyyyyyyy xxxxxxxx`, например € | `1110yyyy` | `10yyyyxx` | `10xxxxxx` | |
| `U+010000-U+10FFFF` `000zzzzz yyyyyyyy xxxxxxxx`, не BMP, например 𨭎, 𠬠, 😼 | `11110zzz` | `10zzyyyy` | `10yyyyxx` | `10xxxxxx` |

- - - - - - - - -

## Punycode

Для доменов, с сохранением ASCII-фрагмента

Для «почти ASCII» — неплохо:
* http://bücher.org/ → http://xn--bcher-kva.org/

@pause@

Для «совсем не ASCII» — плохо:

* 1ш2щ3.ru → xn--123-xfdg.ru
* 點看 → xn--c1yn36f

@pause@

Забавный алгоритм и поучительная история.

1. Не-ASCII именование доменов не поддерживал никто
2. Браузеры начали поддерживать домены в Unicode и Punycode — лучшее время, всё просто работало =)
3. Регистраторы стали «поддерживать» Unicode-домены, т.е. обнаруживать их регистрацию и требовать дополнительные деньги

= = = = = =

# Упражнения и вопросы

- - - - - -

## Упражнения

* Напишите программу, производящую декомпозицию символов известных Вам языков на отдельные символы и модификаторы
* Преобразуйте несколько текстов своей программой; попытайтесь отредактировать их разными редакторами; опишите свои впечатления
* Реализуйте кодировщик и/или декодировщик Punycode

## Вопросы

* Что такое символ и глиф?
* Что такое бит и байт?
* Что такое набор символов и кодировка?
* Опишите пространство символов Unicode
* Что такое нормализация?
* Для каких единиц текста задаются правила упорядочивания в Unicode?
* Приведите примеры кодировок для различных наборов символов
